# Module 11 Virtual Class (Required): 

## Overview 

This session reviews Express server basics. Students will use `app.post` to handle POST requests. Students will also build a "Star Wars API" application that will serve both API routes and HTML routes, similar to their challenge. 

## Learning Objectives

By the end of class, students will be able to:

* Create a route that handles POST requests 

* Explain the purpose of `app.use(express.urlencoded())` middleware

* Explain the purpose of `app.use(express.json())` middleware

* Create a route that sends HTML to the client

## Preparing For Class/Instructor Notes 

* When reviewing activities, ask for volunteers to share their solutions and/or ask students to walk through the solution, line-by-line.

* If you are comfortable doing so, live code the solutions to the activities. If not, no worries. Use the solutions provided and follow the prompts and talking points for review. 

* If you are comfortable doing so, share your struggle and/or personal experiences learning and working with the concepts covered in this lesson.

* Ensure that you are using the correct versions of Express (v4).

* Students will find `app.use()` challenging. Review the `03-Stu_POST-Server` activity prior to class and be prepared to discuss both middlewares.

* In the async material, 
* 
* . jQuery is introduced in Lesson 3 where students are tasked with adding drag and drop functionality to the Taskmaster Pro webpage.


## Pre-Class Activity/Warm-Up 

Encourage students to work on the remaining module algorithm(s) during office hours. Offer to review the algorithm(s) 5 or 10 minutes before class begins or during office hours after class.


## Time Tracker 
@TODO
[05-Third-Party-APIs Time Trackers](https://docs.google.com/spreadsheets/d/1tQna4I3Mrcdf0tQJLwsArIC_PxbJCdsbYCUw7th2gt0/edit?usp=sharing)


---

### 1. Icebreaker Activity (10 min)

* Welcome students to class.

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ What did we learn this week? How would you explain it to your friends and family?

    * 🙋 We learned how to use Express to set up servers that listen for requests from a client. Clients can be mobile devices, desktop computers, laptops, and even smart fridges! 

    * ☝️ Did anyone have an 'ah-ha' moment this week? When and why did it click? 

    * 🙋 Eureka moments happen when we try different approaches to a problem or change the way we are thinking about the problem.

    * ☝️ Did anyone feel stuck this week? How did you get unstuck?

    * 🙋 It's easy to get stuck when you're learning web development. It's important to learn how get unstuck because it happens to the pros, too. Rather than getting lost in search results, consult the official documentation first. Then ask for help from instructional staff or your peers. Study groups are a great because explaining your problems to someone else often reveals their solution. 


### 2. Instructor Do: Introduce Challenge (5 min)

* Open `/02-Challenge/Master/index.html` in your browser and explain the following:

    * This weeks challenge is a "Note Taker". It allows us to add new notes and save them to a JSON file. It also persists the data so that any time we would like to view our notes, they'll still be there, even if we had to restart the server.

    * 🔑 On the main page, we can choose to add a new note, or view existing notes.

    * 🔑 If we click on an existing note, the create note section is changed to show a detailed view of the note we clicked on. 

    * 🔑 We also have the option to delete the note, removing it from the JSON file that stores it. 

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ What recently acquired skills will help us build this challenge?

    * 🙋 We can use Express to serve the list of animals or zookeepers.

    * ☝️ How are these skills relevant to a career in web development?

    * 🙋 APIs are a necessary piece of many web applications. 

    * ☝️ How will this challenge improve your portfolio?

    * 🙋 This challenge will demonstrate knowledge of Express and Node, demonstrating that we create back ends for our clients to interact with.

* Answer any questions before proceeding to the next activity.


### 3. Instructor Demo: Creating POST routes (5 min) 

* Use the prompts and talking points below to demonstrate the following key point(s):

    * ✔️ POST requests

    * ✔️ Insomnia makes testing POST requests eaiser

* Open the Insomnia application and explain the following:

    * 🔑 Insomnia allows us to choose the type of request we'd like to make. 

    * 🔑 After adding the route to insomnia, we need to make sure we select JSON as the body type.

    * 🔑 To send a request to the server, all we need to do is click on "Send" and wait for a response. If this doesn't work, we should look in the server's console to see if there are any errors.

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ Why can't we do this from the browser?

    * 🙋 The browser automatically makes a GET request to whichever route is typed into the URL bar.

    * ☝️ How does this activity equip us for the challenge?

    * 🙋 It provides practice in creating POST routes. 

    * ☝️ How would we build this?

    * 🙋 We know that it will look similar to the GET routes, but this time we need to be able to handle the data being sent over. 

* Answer any questions before proceeding to the next activity.


### 4. Student Do: Creating POST routes (10 or 15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `/03-Stu_POST_Server`.

```md
    # POST Requests

    ## Instructions

    * Create a POST route in `server.js` that adds new characters to the data object. 

    * Use Insomnia to send a POST request to the server. Confirm that your character has been added to the dataset correctly.   
```


### 5. Instructor Review: Creating POST routes (5 or 10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to demonstrate the following key point(s):

    * ✔️ Creating a new POST route in `server.js`

    * ✔️ Adding the proper middleware so that Express can handle a JSON body

    * ✔️ Using Insomnia to send a POST request to the server

* Open `/03-Stu_POST_Server` in your IDE and explain the following:

    * 🔑 We start by adding middleware so that Express can handle data parsing. 

    ```js
     // Sets up the Express app to handle data parsing
    app.use(express.urlencoded({ extended: true }));
    app.use(express.json());
    ```

    * ☝️ What does `express.urlencoded({ extended:true })` do?

    * 🙋 It allows our app to parse nested objects from the body.

    * 🔑 The only difference between declaring a GET route and POST route is the method name.

    ```js
    // Create New Characters - takes in JSON input
    app.post('/api/characters', (req, res) => {
    ```

    * 🔑 Next we set a variable to `req.body`, the body of data that is passed to the back end .

    ```html
    const newCharacter = req.body;
    ```

    * 🔑 After console logging the new character, we push it to the characters array.

    * 🔑 Finally we use `res.json` to send a response to the client.

    ```js
        console.log(newCharacter);

        characters.push(newCharacter);

        res.json(newCharacter);
    });
    ```

    * 🔑 To test this route, we will POST to `localhost:3000/api/characters`, using the following data:

    ```json
    {
        "routeName": 'leia',
        "name": 'Leia Organa',
        "role": 'General',
        "age": 60,
        "forcePoints": 1000
    }
    ```

    * 🔑 Don't forget that the data needs to be JSON, not just JavaScript objects

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ What happens to our newly posted data after our server is shut down?

    * 🙋 It's lost forever. In order to prevent this, we would need to save it in a file or database.

    * ☝️ Is Insomnia used in real back ends?

    * 🙋 Insomnia helps us test all different kinds of routes, including those in production. Remember that after 

    * ☝️ What can we do if we don't completely understanding this?

    * 🙋 We can refer to the lesson plan, read the [Express Routing documentation](https://expressjs.com/en/starter/basic-routing.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 6. Instructor Demo: Serving Static Files (5 min) 

* Use the prompts and talking points below to demonstrate the following key point(s):

    * ✔️ Serving HTML with Express

* Open  `/04-Stu_Static/Solved/server.js` from the command line and run `node server.js`.

* Open http://localhost:3000/ in your browser and explain the following:

    * Navigating to a route on localhost displays an HTML page instead of JSON data.

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ Where have we used this before?

    * 🙋 We used this to serve all of the HTML routes for the zookeeper and animals pages.

    * ☝️ How does this activity equip us for the challenge?

    * 🙋 We will use this to serve all of the HTML routes for the zookeeper and animals pages.

    * ☝️ How would we build this?

    * 🙋 We will create a GET route that sends back an HTML file instead of JSON.

* Answer any questions before proceeding to the next activity.

### 7. Student Do: Serving Static Files (10 or 15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `/04-Stu_Static`.

```md
# Serving Static Files

## Instructions

* Update the home route to use `res.sendFile` and `path.join` to return `index.html` when a request is made at `/`. 

```

### 8. Instructor Review: Serving Static Files (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to review the following key point(s):

    * ✔️ Sending a file with `res.sendFile()`

    * ✔️ Joining a file path with `path.join()`

* Open  `/04-Stu_Static/Solved/server.js` from the command line and run `node server.js`.

* Open http://localhost:3000 in the browser and point out the following:

    * 🔑 The page served to us on the `/` route matches the HTML in `index.html`

* Open  `/04-Stu_Static/Solved/server.js` in your IDE and explain the following:

    ```js
    res.sendFile(path.join(__dirname, 'index.html'));
    ```

    * 🔑 `res.sendFile()` allows us to send back a static file to the client, rather than JSON or a plaintext response.

    * 🔑 In order to use `sendFile`, we need to provide the absolute path to the HTML file. We can do this by combining the full path of the directory that we're in with the relative path to the file we want to send. 

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ Why can't we just use `./` instead of `__dirname`?

    * 🙋 `./` refers to the current working directory, which is the directory that node is ran from. It is important to keep in mind that the `node` can be ran from anywhere. We can't guarantee that the user of our application will run `node server.js`, and not `node someParentPath/server.js`.

    * ☝️ What can we do if we don't completely understanding this?

    * 🙋 We can refer to the lesson plan, read the [Express.js docs](https://expressjs.com/en/api.html), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 9. Instructor Demo: Posting Data (5 min) 

* Use the prompts and talking points below to demonstrate the following key point(s):

    * ✔️ Getting form values with jQuery

    * ✔️ POST data to a server using `$.post()`

    * ✔️ Setting up a route so that it can accept JSON data from a POST request

* Open `/05-Stu_POST-Client/Solved/server.js` from the command line and run `node server.js`:

* Open http://localhost:3000/add in the browser and point out the following:

    * 🔑 The HTML that is served back to us is different from the `index.html`. This one has form elements.

* Open the Network tab in your browser's Developer Tools and points out the following
    
    * 🔑 If we fill out the various form fields, and hit submit, we can see a POST request is made to our server.

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ Where have we used this before?

    * 🙋 We used this to add animals and zookeepers to the Zoo Keepr application.

    * ☝️ How does this activity equip us for the challenge?

    * 🙋 We will need to be able to hook up a front end to a back end, and allow POST requests to be made. 

    * ☝️ How would we build the back end part of this?

    * 🙋 We would start by creating a POST route that allows us to accept new characters. Then we would want our characters array to change so that it includes the new character as well.

    * ☝️ How would we build the back end part of this?
  
    * 🙋 We would change the front end by scaffolding our HTML, then pseudocode our script functionality to listen for form submission, get the value in the form field, and finally making a POST request to our server.

* Answer any questions before proceeding to the next activity.


### 10. Student Do: POST Client (15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `/05-Stu_POST-Client`.

```md
   # POST Client

    ## Instructions

    * Create an `add` route in `server.js` that returns `add.html`. 


    ## Bonus 

    * Research Regular Expressions (RegEx) and look for a way to use the following code snippet when creating route names:

    .replace(/\s+/g, "")

```

### 11. Instructor Review: POST Client (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to demonstrate the following key point(s):

    * ✔️ Serving multiple HTML pages

    * ✔️ Using `$.post()` in client-side JavaScript to submit form data

* Open `/05-Stu_POST-Client/Solved/server.js` in your IDE and explain the following:

    ```js
    app.get('/add', (req, res) => {
        res.sendFile(path.join(__dirname, 'add.html'));
    });
    ```

    * 🔑 We can serve other pages on different routes, just by changing the first argument of `app.get()`.

    ```js
    app.post('/api/characters', (req, res) => {
        const newCharacter = req.body;

    ```

    * 🔑 `req.body` is equal to the JSON post sent from the user

    ```js
        newCharacter.routeName = newCharacter.name.replace(/\s+/g, '').toLowerCase();

        console.log(newCharacter);

        characters.push(newCharacter);

        res.json(newCharacter);
    });
    ```

    * 🔑 We used the regular expression provided in the instructions to remove all spaces from the route name. 

    * 🔑 We then `console.log` our new character to ensure that it's what we expect it to be, then push it to the characters array.

    * 🔑 Finally, we respond with a json of the newly created character. Since in our example, the client doesn't use the `newCharacter`, we could also just return a `200` code to indicate that the character creation was successful. We're going to res.json the whole character so that we can `console.log()` it on the client side.

* Open `/05-Stu_POST-Client/Solved/add.html` in your IDE and explain the following:

    ```js
    $("#add-btn").on("click", function (event) {
        event.preventDefault();
        const newCharacter = {
            name: $("#name").val().trim(),
            role: $("#role").val().trim(),
            age: $("#age").val().trim(),
            forcePoints: $("#force-points").val().trim()
        };

    ```

    * 🔑 We can set up an event listener for the click event on our `add` button.

    * 🔑 We can also use either jQuery or VanillaJS to select the various form fields and extract their values.

    ```js
    $.post("/api/characters", newCharacter)
            .then(function (data) {
            console.log("add.html", data);
            alert("Adding character...");
            });
    ```

    * 🔑 Inside the event listener callback, we can make a POST request using `$.post` and our new character object.

    * 🔑 Then, once the server responds to us, we will `console.log` the new character and `alert()` the user.

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ What is `req.body` used for?

    * 🙋 `req.body` is whatever is sent in a POST request. We can use the contents of `req.body` to create new items.

    * ☝️ What does `$.post()` do?

    * 🙋 `$.post()` allows us to post data to our sever, then do something after the server returns a response.

    * ☝️ What can we do if we don't completely understanding this?

    * 🙋 We can refer to the lesson plan, read [POST Express.js documentation](https://expressjs.com/en/5x/api.html#app.post.method) and stick around for office hours to ask for help.


### 12. Recap (5 min)

* Ask the class the following question(s) and call on students for the corresponding answer(s):

    * ☝️ What do you think you absolutely need to know to succeed at the challenge?

    * 🙋 To succeed at the challenge, we need to know how to build routes using Express. We also need to know how to do the following with Express: Accept POST requests, GET requests, serve back data. Lastly, we need to be able to send back HTML to the browser.

    * ☝️ What do you think is okay to not completely understand?

    * 🙋 All of it! Remember that we are learning about a large framework that has many methods and techniques. It's going to take a little bit of time before you start to feel comfortable creating servers from scratch.

    * ☝️ Why is it important to do as much of the lesson material as possible?

    * 🙋 It's important to do as much of the lesson material prior to class to not only be fully prepared to start the challenge, but your career as a web developer. We cover a lot of material in our bootcamp. Lessons are designed to give each topic a unique and optimal amount of depth so we can provide the scope needed to confidently build upon, while ensuring time for other important material.


### 13. Promote Additional Resources (5 min)

* Direct students to the additional resources available to them:

    * Reference pages

    * Career Services content

    * Reflection + Retrieval


### 14. Transition to Challenge Study Hall/Office Hours (1 min)

* Announce 'office hours' and invite students to stay on the Zoom and ‘start the challenge’ while they have live support from instructional staff. 
# Module 21 Virtual Class: MERN

## Overview 

In today's virtual class, students will practice using GraphQL and JSON Web Tokens.


## Learning Objectives

By the end of class, students will be able to:

* create a GraphQL schema (`typeDefs` and `resolvers`) 

* authenticate a user using JWT


## Instructor Notes

* Be sure to prepare and read over the activities before your class begins. Try to anticipate any questions students may have. 

* During activities, visit a few breakout rooms quietly and ask the group if they are comfortable with the activity and provide gentle tips to keep them on track.

* GraphQL Schema was covered in Lesson 1 and JWT was covered in Lesson 2.


## Time Tracker 

| Start  | #  | Activity Name                     | Duration |
|---     |--- |---                                |---       |
| 7:00PM | 1  | Everyone Do: Career Connection    | 0:20     |
| 7:20PM | 2  | Instructor Do: Student Check-In   | 0:05     |
| 7:25PM | 3  | Instructor Demo: GraphQL Schema   | 0:05     |
| 7:30PM | 4  | Student Do: GraphQL Schema        | 0:15     |
| 7:45PM | 5  | Instructor Review: GraphQL Schema | 0:10     |
| 7:55PM | 6  | Instructor Demo: JWT              | 0:05     |
| 8:00PM | 7  | Student Do: JWT                   | 0:15     |
| 8:15PM | 8  | Instructor Review: JWT            | 0:10     |
| 8:25PM | 9  | Recap                             | 0:05     |
| 8:30PM | 10 | Office Hours                      | 0:30     |
| 9:00PM | 11 | End                               | N/A      |

---

## Class Instructions 

### 1. Everyone Do: Career Connection (20 min)

* Welcome students to class.

* Invite students to post questions in the Zoom chat so TAs and/or the instructor can address them at the end of class.

* Open the lesson's [slide deck](https://docs.google.com/presentation/d/1P8vSht6Vrp4Dljj3QEkvf8LPNSGAUAjUjnSFE9s5Rbk/edit?usp=sharing) and walk through the following slides on foundation setting: 

    **Big Picture**: This is an opportunity to look at the big picture of where students are in the course. Take a moment to discuss a few real-world examples of why this week's topics are valuable.

    **Boot Camp Pointers**: Review some logistics that will help students stay on track. This is an opportunity to speak to what students might need at this particular point in the course. 

    **This Week**: Review the key skills students will be learning this week. 

    **This Week's Assignment**: Give a quick summary of this week's Challenge assignment and describe how the skills they learn throughout the week will be applied to it.

    **Career Connection**: Reinforce that students will use the skills they learn this week throughout their careers. It's important for them to know the "why" and "how" behind the "what." Give examples of how these skills are used on the job. If you feel comfortable, share examples of how you have used them in your professional career.

    * Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

        * â˜ 

        * ğŸ™‹ 

    **How to Succeed This Week**: Remind students that they might experience moments of frustration as they learn complex concepts and tools, and that these times are actually proven opportunities to deepen knowledge. Consider sharing something about your personal learning journey. This helps students recognize that everyone starts somewhere and that they are not alone.

    **Today's Objectives**: Outline the concepts that will be covered in today's lesson. Remind students that they can find the relevant activity files in the "Getting Ready for Class" page in their course content. 

### 2. Instructor Do: Student Check-In (5 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How are you feeling about your progress so far?

  * ğŸ™‹ We are adding another layer to our full-stack skill set. It's important to look back at what we've accomplished and acknowledge that it is a lot! Itâ€™s also okay to feel overwhelmed&mdash;as long as you donâ€™t give up.

  * â˜ï¸ How comfortable do you feel with this topic?

  * ğŸ™‹ Let's do Fist to Five together. If you are not feeling confident, hold up a fist (0). If you feel very confident, hold up an open hand (5).

### 3. Instructor Demo: GraphQL Schema (5 min) 

* Navigate to `01-GraphQL-Schema/Solved` in your command line and run `npm install` and `npm run seed`. 

* If everything is installed and seeded correctly, run `npm run watch` and open your browser to <http://localhost:3001/graphql> to view the GraphQL Playground and demonstrate the following:

    * ğŸ”‘ We can query all users by adding this query syntax in the left pane of the GraphQL Playground:

    ```js
    query {
        users {
            _id
            name
            email
            job
            country
        }
    }
    ```

    * ğŸ”‘ In the right pane, we can see all of the users in the database with all of the properties we asked for.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

    * â˜ï¸ Where have we used this before?

    * ğŸ™‹ In Lesson 1, we set up the `typeDefs` and `resolvers` for the `Thought` and `Users` models.

    * â˜ï¸ How does this activity equip us for the challenge?

    * ğŸ™‹ We will be using GraphQL for our challenge, so we need to know how to create schemas for our models.

    * â˜ï¸ How would we build this?

    * ğŸ™‹ We need to create type definitions for the `User` and `Query` data types, and we need to create a resolver for the `Query` for all `User`s.

* Answer any questions before proceeding to the next activity.


### 4. Student Do: GraphQL Schema (15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `01-GraphQL-Schema/README.md`.

```md
# GraphQL Schema

In this activity, you will create a schema for users for a GraphQL API.

## Instructions

* Navigate to [Unsolved](Unsolved/) in your command line and run `npm install` and `npm run seed`.

* Check out the [User.js](Unsolved/models/User.js) file for the `User` model. You will need to know these fields to create type definitions for the `User` data type.

* Create a folder called `schemas` with three files in it: `typeDefs.js`, `resolvers.js`, and `index.js`

  * In `typeDefs.js`, create type definitions for the `User` and `Query` data type.

    * For `User`, include the same fields that were defined in the Mongoose `UserSchema` plus an `_id` field.

    * For `Query`, create a `users` query that will return an array of `User`s.

    * Remember to import the `gql` tagged template function from `apollo-server-express`!

  * In `resolvers.js`, create a `Query` for all `users`.

    * Perform a `.find()` method on the `User` model to get all users.

    * Remember to import the `User` model!

  * In `index.js`, connect the two files and export them.

* To check if everything is working properly, run `npm run watch` in your command line and open your browser to <http://localhost:3001/graphql> to view the GraphQL Playground.

  * Test out the query for all users. For example, `query { users { name }}` should get you a list of all the users' names.

* Press `CTRL + C` to stop the server before moving on to the next activity.

## Hint(s)

* You can refer to the [Apollo Server Docs for Schemas](https://www.apollographql.com/docs/apollo-server/schema/schema/).

## Bonus

* When querying users, omit the Mongoose-specific `__v` property and the user's password information.
```

### 5. Instructor Review: GraphQL Schema (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to review the following key (ğŸ”‘) points:

    * âœ”ï¸ `typeDefs`

    * âœ”ï¸ `resolvers`

* Open `01-GraphQL-Schema/Solved/schemas/typeDefs.js` in your IDE and explain the following: 

    * First, we need to import `gql` from `apollo-server-express`.

    ```js
    const { gql } = require('apollo-server-express');
    ```

    * ğŸ”‘ Then we need to create two type definitions, `User` and `Query`. 
    
    ```js
    const typeDefs = gql`
      type User {}

      type Query {}
      `;
    ```

    * First for `User`, we need to specify the fields we want returned. For that, we could look at the `User` model.

    ```js
    type User {
        _id: ID
        name: String
        email: String
        password: String
        job: String
        country: String
    }
    ```

    * Then for `Query`, it will return an array of the `User` data type we just created.

    ```js
    type Query {
        users: [User]
    }
    ```

    * Lastly, we remember to export the `typeDefs`

    ```js
    module.exports = typeDefs;
    ```

* Open `01-GraphQL-Schema/Solved/schemas/resolvers.js` in your IDE and explain the following: 

    * Next, we need to set up the resolvers. First, we need to import the `User` model on top.

    ```js
    const { User } = require('../models');
    ```

    * ğŸ”‘ Then we create a resolver function to query all users. We will perform a `.find()` method on the `User` model.

    * If you did the bonus, we can omit the `__v` property and the password by chaining `.select('-__v -password')` after the `.find()` method.

    ```js
    const resolver = {
        Query: {
            users: async () => {
                return User.find().select('-__v -password')
            }
        }
    }
    ```

    * Finally, we need to export the `resolvers`.

    ```js
    module.exports = resolvers;
    ```

* Open `01-GraphQL-Schema/Solved/schemas/index.js` in your IDE and explain the following: 

    * Lastly, we need to connect these two files and export them.

    ```js
    const typeDefs = require('./typeDefs');
    const resolvers = require('./resolvers');

    module.exports = { typeDefs, resolvers };
    ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

    * â˜ï¸ What will happen if we simply query `query { users }` in GraphQL Playground?

    * ğŸ™‹ It will give us an error message saying we didn't give a selection of subfields. Since the query `users` will return an array of the `User` data type, you need to specify which fields you want returned. This allows us to use one query to retrieve as much or as little data as we need. For example, if we only needed the names of the users, we just need to query `query { users { name } }`. 

    * â˜ï¸ What can we do if we don't completely understand this?

    * ğŸ™‹ We can refer to Lesson 1, read the [Apollo Server Docs for Schemas](https://www.apollographql.com/docs/apollo-server/schema/schema/), and stick around for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 6. Instructor Demo: JWT (5 min) 

* Navigate to `02-JSON-Web-Token/Solved` in your command line and run `npm install`.

* Run `npm run watch` and open your browser to <http://localhost:3001/graphql> to view the GraphQL Playground and demonstrate the following:

    * ğŸ”‘ For this activity's purposes, we can query all users for their password (normally we should omit the password). So in the left pane, we will query for all users' email and password:

    ```js
    query {
        users {
            email
            password
        }
    }
    ```

    * ğŸ”‘ Let's choose one user's email and password to test out the `login()` mutation.

    * ğŸ”‘ In another tab in GraphQL Playground, we can test the `login()` mutation by using the query variables `email` and `password` of the user we chose.

    ```js
    mutation login($email: String!, $password: String!) {
        login(email: $email, password: $password) {
            token
            user {
                _id
                name
            }
        }
    }

    // In the Query Variables pane
    {
        "email": "enter the email of the user here"
        "password": "enter the password"
    }
    ```

    * ğŸ”‘ If the login is successful, we can see the response that includes a `token` and the user's `id` and `name`.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

    * â˜ï¸ Where have we used this before?

    * ğŸ™‹ We implemented JWT to authenticate users in Lesson 2.

    * â˜ï¸ How does this activity equip us for the challenge?

    * ğŸ™‹ Our challenge will also utilize JWT to login users.

    * â˜ï¸ How would we build this?

    * ğŸ™‹ We would need to generate the JWT, create a new `Auth` type definition, and add a `login()` mutation.

* Answer any questions before proceeding to the next activity.


### 7. Student Do: JWT (15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `02-JSON-Web-Token/README.md`.

```md
# JSON Web Token

In this activity, you will implement JSON Web Tokens as a way to authenticate a user logging in.

## Instructions

* Navigate to [Unsolved](Unsolved/) in your command line and run `npm install`.

* Create a folder called `utils` with a new file called `auth.js`.

  * Require `jsonwebtoken` on top.

  * Create a JWT `secret` and an `expiration`.

  * Export the `signToken()` function that takes in a `user` object and adds the `email` and `_id` properties to the token, along with the `secret` and `expiration`.

* Open [typeDefs.js](Unsolved/schemas/typeDefs.js) and define a new `Mutation` and `Auth` type.

  * Add a `login()` mutation that takes in an `email` and `password` and returns an `Auth` object.

  * Add a `Auth` type that must return a `token` and can include any other `user` data.

* Open [resolvers.js](Unsolved/schemas/resolvers.js) and import the `signToken()` function on top.

  * Update the `login()` mutation to sign a `token` and return an object that combines the `token` with the user's data.

* To check if everything is working properly, run `npm run watch` in your command line and open your browser to <http://localhost:3001/graphql> to view the GraphQL Playground.

  * Query all users for their `email` and `password`. For now, you should be able to see their passwords. Make note of one user's email and password to test out the `login()` mutation.

  * Open another tab in GraphQL Playground and test the `login()` mutation using the query variables `email` and `password` of the user noted above.

  * You should be able to see the `token` along with any other `user` data you included.

* Press `CTRL + C` to stop the server before moving on to the next activity.

## Hint(s)

* You can refer to the [Introduction to JSON Web Tokens Docs](https://jwt.io/introduction/).
```

### 8. Instructor Review: JWT (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to review the following key (ğŸ”‘) points:

    * âœ”ï¸ `signToken()`

    * âœ”ï¸ `login()` mutation

    * âœ”ï¸ `Auth` type

    * âœ”ï¸ `login()` resolver

* Open `02-JSON-Web-Token/Solved/utils/auth.js` in your IDE and explain the following: 

    * First, we need to import `jsonwebtoken` at the top of the page.

    ```js
    const jwt = require('jsonwebtoken');
    ```

    * Then we create a JWT secret and expiration.

    ```js
    const secret = 'mysecretssshhhhhhh';
    const expiration = '2h';
    ```

    * ğŸ”‘ Finally we export the `signToken()` function that takes in a `user` object and adds the `user` properties you want to the token, along with the expiration and secret.

    ```js
    module.exports = {
      signToken: function({ email, _id }) {
        const payload = { email, _id };
        return jwt.sign({ data: payload }, secret, { expiresIn: expiration });
      }
    };
    ```

* Open `02-JSON-Web-Token/Solved/schemas/typeDefs.js` in your IDE and explain the following: 

    * ğŸ”‘ We need to create a new `Mutation` type for `login()` that will return an `Auth` object.

    ```js
    type Mutation {
      login(email: String!, password: String!): Auth
    }
    ```

    * ğŸ”‘ We need to create a new `Auth` type that will return a `token` and any other `user` data.

    ```js
    type Auth {
      token: ID!
      user: User
    }
    ```

* Open `02-JSON-Web-Token/Solved/schemas/resolvers.js` in your IDE and explain the following: 

    * Before we update the `login()` resolver, we need to import `signToken()`. 

    ```js
    const { signToken } = require('../utils/auth')
    ```

    * ğŸ”‘ Then we need to update the `login()` resolver to sign a token and return an object that combines the token with the user's data.

    ```js
    const token = signToken(user);
    return { token, user };
    ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

    * â˜ï¸ What are some benefits to using JWT?

    * ğŸ™‹ They contain all the data you need encoded into a single string; they eliminate the need to save a session ID on the back end of in the database; they decrease the amount of server-side resources needed to maintain authentication; they can be generated anywhere and aren't tied to a single domain.

    * â˜ï¸ What can we do if we don't completely understand this?

    * ğŸ™‹ We can refer to Lesson 2, read the [Introduction to JSON Web Tokens Docs](https://jwt.io/introduction/), and stick around for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 9. Recap (5 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

    * â˜ï¸ What topics did we cover today? What are the main takeaways?

    * ğŸ™‹ We covered the basics of GraphQL schemas and JWT.

    * â˜ï¸ What do you think is okay to not completely understand?

    * ğŸ™‹ All of it! The field of web development is very wide and rapidly evolving. Unless you choose to specialize, it's not necessary to know any one area completely to be successful. 

    * â˜ï¸ Why is it important to do as much of the lesson material before class as possible?

    * ğŸ™‹ It's important both to be fully prepared to start the challenge and because it will prepare you for your future career as a web developer. We cover a lot of material in the boot camp. Lessons are intentionally designed to give each topic an optimal amount of depth and scope so that you have a solid foundation to build upon in future lessons. The skills you learn in the lessons are cutting-edge, real-world skills that you will use in your career as a full-stack web developer. 

    * â˜ï¸ Where in the asynchronous lessons can you learn more?

    * ğŸ™‹ GraphQL schemas were covered in Lesson 1 and JWT in Lesson 2.

    * â˜ï¸ What excites you about the remaining lessons for this week?

* Use student answers to transition to Office Hours.


### 10. Office Hours (30 min)

* Announce Office Hours and invite students to stay on the Zoom and start the challenge while they have live support from instructional staff. 


### 11. End

How did todayâ€™s lesson go? Your feedback is important. Please take 5 minutes to complete [this anonymous survey](https://forms.gle/3LozVjherGH83aG17).

---
Â© 2020 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.

# Module 13 Virtual Class (Required): Object-Relational Mapping

## Overview 

In today's required virtual class, students will review Sequelize CRUD methods, associations, and the `include` option for queries.

## Learning Objectives

By the end of class, students will be able to:

* Add validations to models

* Use Sequelize CRUD methods in routes

* Create relationships between models

* Make queries using the Sequelize `include` option


## Instructor Notes 

* Be sure to prepare and read over the activities before your class begins. Try to anticipate any questions students may have.

* Make sure you change all of the connection information so the examples have your MySQL username/password!

* If you don't want to do it live in class, create the databases required for today's exercises before class.

* BE VERY CAREFUL NOT TO GO TOO IN DEPTH. There are a ton of components that make Sequelize work, but much of it is boilerplate that doesn't need much explanation. 

* THIS IS TOUGH STUFF! This week, tell your class to not feel discouraged if there are concepts that they can't nail down completely. Tell them to try their best, but to speak with you or a TA if they're unsure of anything.

* The first activity `03-Blog-CRUD` will take longer than the usual 15 minutes, but the other activities won't take as long. So note the adjusted `Time Tracker` and allocated time for each activity today.

* @TODO { REFERENCE TO ASYNC }


## Office Hours

Encourage students to work on the remaining module algorithms during Office Hours. Review the algorithm solutions 5‚Äì10 minutes before class begins or during Office Hours after class.


## Time Tracker 

| Start  | #   | Activity Name                       | Duration |
| ------ | --- | ----------------------------        | -------- |
| 6:30PM | 0   | Office Hours                        | 0:30     |
| 7:00PM | 1   | Introduction                        | 0:10     |
| 7:10PM | 2   | Review Current Challenge            | 0:05     |
| 7:15PM | 3   | Instructor Demo: Blog CRUD          | 0:05     |
| 7:20PM | 4   | Student Do: Blog CRUD               | 0:25     |
| 7:45PM | 5   | Instructor Review: Blog CRUD        | 0:10     |
| 7:55PM | 6   | Instructor Demo: Blog Association   | 0:05     |
| 8:00PM | 7   | Student Do: Blog Association        | 0:10     |
| 8:10PM | 8   | Instructor Review: Blog Association | 0:10     |
| 8:20PM | 9   | Instructor Demo: Blog Joins         | 0:05     |
| 8:25PM | 10  | Student Do: Blog Joins              | 0:15     |
| 8:40PM | 11  | Instructor Review: Blog Joins       | 0:10     |
| 8:50PM | 12  | Recap & Promote Resources           | 0:05     |
| 8:55PM | 13  | Introduce Upcoming Challenge        | 0:05     |
| 9:00PM | 14  | Office Hours                        | 0:30     |
| 9:30PM | 15  | End                                 | N/A      |
---

## Class Instructions

### 1. Introduction (10 min)

* Welcome students to class.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è What did you learn this week? How would you explain it to your friends and family?

    * üôã We learned about Sequelize, which is a promise-based Node.js ORM for MySQL. We are moving fast compared to traditional learners. It‚Äôs okay to feel overwhelmed as long as you don‚Äôt give up.

    * ‚òùÔ∏è Did anyone have an "Aha!" or "Eureka!" moment this week? When was it and why did things suddenly click for you? 

    * üôã Eureka moments happen when we try different approaches to a problem or change the way we're thinking about it.

    * ‚òùÔ∏è Did anyone feel stuck this week? How did you get unstuck?

    * üôã It's easy to get stuck when you're learning web development. It's important to learn how to get unstuck because it happens to the pros too. Rather than getting lost in search results, consult the tool's official documentation first. Then ask for help from instructional staff or your peers. Study groups are great because explaining your problems to someone else often reveals the solution. 


### 2. Review Current Challenge (5 min)

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED
* Open `@TODO/folder/file` in your browser and demonstrate the following:
* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

    * @TODO { WHEN WE DO THIS, IT DOES THAT. }

    * @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è What recently acquired skills will help us build this challenge?

    * üôã @TODO { YES, WHAT? }

    * ‚òùÔ∏è How are these skills relevant to a career in web development?

    * üôã @TODO { YES, WHAT? }

    * ‚òùÔ∏è How will this challenge improve your portfolio?

    * üôã @TODO { YES, HOW? }

* Answer any questions before proceeding to the next activity.


### 3. Instructor Demo: Blog CRUD (5 min) 

* Be sure to have already created the `blogger` DB, run `npm install`, and modified the `connection.js` file to include your MySQL user/database information. Otherwise, walk through it with the class.

* Navigate to `03-Blog-CRUD/Solved/` in your command line and run `npm start`. Navigate to `localhost:3001` in your browser and demonstrate the following:

    * üîë We can create a few posts and see them all listed.

    * üîë We can choose a category and see the list of posts for that category
    
    * üîë We can edit a post by clicking on it

    * üîë We can delete a post by click on the x

    * üîë If we have nothing written in the body of the post, or if the post title is too long, we won't be able to proceed.

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è Where have we used this before?

    * üôã We've used CRUD methods before but this time we will specifically use Sequelize methods.

    * ‚òùÔ∏è How does this activity equip us for the challenge?

    * üôã @TODO { YES, HOW? } 

    * ‚òùÔ∏è How would we build this?

    * üôã We need to use Sequelize CRUD methods in the appropriate routes.

* Answer any questions before proceeding to the next activity.


### 4. Student Do: Blog CRUD  (25 min) 

* **Let students know that this first activity will be given 25 minutes to complete**

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `03-Blog-CRUD/README.md`.

    ```md
    # Blog CRUD

    In this activity, you will add validations for the `Post` model and add Sequelize CRUD methods to the appropriate routes. 

    ## Instructions

    * Create a `blogger` DB. You will use this database for all of today's activities.

    * Navigate to the [Unsolved](Unsolved/) folder and run `npm install` in your terminal.

    * Be sure to modify the [connection.js](Unsolved/config/connection.js) file to include your MySQL user/database information. 

    * Open the [post.js](Unsolved/models/post.js) file and examine the Sequelize `Post` model.

    * Add the following validations:

        1. Flags to the `title` and `body` to prevent NULL values from being entered.

        2. A validation to the `title` so that it must be between 1 and 160 characters.

        3. A flag to the category so that it has a default value of "Personal" if a value is not supplied.

    * Open the [api-routes.js](Unsolved/routes/api-routes.js) file and fill in each route with the following Sequelize methods:

        * A `findAll()` method inside the GET route to get the posts of a specific category.

        * A `findOne()` method inside the GET route to get a single post using the id from `req.params.id`.

        * A `create()` method inside the POST route to save a new post using the data in `req.body`.

        * A `destroy()` method inside the DELETE route to delete a post using the id from `req.params.id`.

        * An `update()` method inside the PUT route to update a post using the new todo data in `req.body`.

    * To test if everything is working properly, run `npm start` in your terminal. Navigate to `localhost:3001` in your browser and check if we have the following functionality (recommended order):

        1. Create a new post
        
        2. Get a list of all posts
        
        3. Get a list of all posts of a category
        
        4. Edit a post
        
        5. Delete a post

    ## Hint(s)

    * You may need to consult the [Sequelize Validations & Constraints docs](https://sequelize.org/master/manual/validations-and-constraints.html) on how to validate the data.

    * You may need to read the Sequelize documentation on the [findAll()](http://docs.sequelizejs.com/class/lib/model.js~Model.html#static-method-findAll), [create()](http://docs.sequelizejs.com/class/lib/model.js~Model.html#static-method-create), [update()](http://docs.sequelizejs.com/class/lib/model.js~Model.html#static-method-update), [destroy()](http://docs.sequelizejs.com/class/lib/model.js~Model.html#static-method-destroy) methods, as well as check out [how to apply the "where" clause](https://sequelize.org/master/manual/model-querying-basics.html#applying-where-clauses).

    * If things aren't working as expected, check to see if any errors logged to the terminal.
    ```


### 5. Instructor Review: Blog CRUD  (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to review the following key (üîë) points:

    * ‚úîÔ∏è Validations

    * ‚úîÔ∏è `findAll()`

    * ‚úîÔ∏è `findOne()`

    * ‚úîÔ∏è `create()`

    * ‚úîÔ∏è `destroy()`

    * ‚úîÔ∏è `update()`

* Open `03-Blog-CRUD/Solved/models/post.js` in your IDE and explain the following: 

    * üîë We need to add a few validations to our `Post`. First we need to prevent NULL values from being entered in the title and body:

    ```js
    Post.init(
      {
        title: {
          type: DataTypes.STRING,
          allowNull: false
      },
        body: {
          type: DataTypes.TEXT,
          allowNull: false
      }
    });  
    ```

    * Next we need to allow only 1 to 160 characters for the title:

    ```js
    Post.init(
      {
        title: {
          type: DataTypes.STRING,
          allowNull: false,
          validate: {
            len: [1, 160]
          }
        }
    });
    ```

    * Finally we need to give the category a default value of "Personal" if a value is not given.

    ```js
    category: {
      type: DataTypes.STRING,
      defaultValue: 'Personal'
    }
    ```

* Open `03-Blog-CRUD/Solved/routes/api-routes.js` in your IDE and explain the following: 

    * üîë We use the Sequelize `findAll()` method inside the GET route to get the posts of a specific category and return them to the user as JSON.

    ```js
    router.get('/api/posts/category/:category', (req, res) => {
      Post.findAll({
        where: {
          category: req.params.category
        }
      }).then(dbPost => {
        res.json(dbPost);
      });
    });
    ```

    * üîë We use the Sequelize `findOne()` method inside the GET route to get a single post using the `id` from `req.params.id`.

    ```js
    router.get('/api/posts/:id', (req, res) => {
      Post.findOne({
        where: {
          id: req.params.id
        }
      }).then(dbPost => {
        res.json(dbPost);
      });   
    });
    ```

    * üîë We use the Sequelize `create()` method inside the POST route to save a new post using the data in `req.body`.

    ```js
    router.post('/api/posts', (req, res) => {
      console.log(req.body);
      Post.create({
        title: req.body.title,
        body: req.body.body,
        category: req.body.category
      }).then(dbPost => {
        res.json(dbPost);
      });
    });
    ```

    * üîë We use the Sequelize `destroy()` method inside the DELETE route to delete a post using the `id` from `req.params.id`.

    ```js
    router.delete('/api/posts/:id', (req, res) => {
      Post.destroy({
        where: {
          id: req.params.id
        }
      }).then(dbPost => {
        res.json(dbPost);
      });
    });
    ```

    * üîë We use the Sequelize `update()` method inside the PUT route to update a post using the new data in `req.body`.

    ```js
    router.delete('/api/posts/:id', (req, res) => {
      Post.destroy({
        where: {
          id: req.params.id
        }
      }).then(dbPost => {
        res.json(dbPost);
      });
    });
    ```

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

    * üôã @TODO { YES, WE DO! }

    * ‚òùÔ∏è What can you do if you don't completely understand this?

    * üôã @TODO We can refer to the lesson plan, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 6. Instructor Demo: { ACTIVITY NAME }  (5 min) 

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED
* Open `@TODO/folder/file` in your browser and demonstrate the following:
* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

    * üîë @TODO { WHEN WE DO THIS, IT DOES THAT. }

    * üîë @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è Where have we used this before?

    * üôã @TODO We used this to accomplish { X, Y, Z }, in { CORRESPONDING ASYNCHRONOUS LESSON PLAN }.

    * ‚òùÔ∏è How does this activity equip us for the challenge?

    * üôã @TODO { YES, HOW? } 

    * ‚òùÔ∏è How would we build this?

    * üôã @TODO { YES, HOW? } 

* Answer any questions before proceeding to the next activity.


### 7. Student Do: { ACTIVITY NAME }  (15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `@TODO/folder/file`.

```md
    @TODO add instructions; tabbed
```


### 8. Instructor Review: { ACTIVITY NAME }  (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to review the following key (üîë) points:

    * ‚úîÔ∏è @TODO { THIS }

    * ‚úîÔ∏è @TODO { THAT }

    * ‚úîÔ∏è @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

    * @TODO { WE DO THIS AND THE RESULT IS THAT }

    ```
    @TODO ADD CODE SNIPPET, TABBED
    ```

    * üîë @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

    * üôã @TODO { YES, WE DO! }

    * ‚òùÔ∏è What can you do if you don't completely understand this?

    * üôã @TODO We can refer to the lesson plan, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 9. Instructor Demo: { ACTIVITY NAME }  (5 min) 

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED
* Open `@TODO/folder/file` in your browser and demonstrate the following:
* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

    * üîë @TODO { WHEN WE DO THIS, IT DOES THAT. }

    * üîë @TODO { WE ALSO SEE THESE THINGS. }

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è Where have we used this before?

    * üôã @TODO We used this to accomplish { X, Y, Z }, in { CORRESPONDING ASYNCHRONOUS LESSON PLAN }.

    * ‚òùÔ∏è How does this activity equip us for the challenge?

    * üôã @TODO { YES, HOW? } 

    * ‚òùÔ∏è How would we build this?

    * üôã @TODO { YES, HOW? } 

* Answer any questions before proceeding to the next activity.


### 10. Student Do: { ACTIVITY NAME }  (20 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `@TODO/folder/file`.

```md
    @TODO ADD INSTRUCTIONS; TABBED
```


### 11. Instructor Review: { ACTIVITY NAME }  (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points below to review the following key (üîë) points:

    * ‚úîÔ∏è @TODO { THIS }

    * ‚úîÔ∏è @TODO { THAT }

    * ‚úîÔ∏è @TODO { THE OTHER }

* Open `@TODO/folder/file` in your IDE and explain the following: 

    * @TODO { WE DO THIS AND THE RESULT IS THAT }

    ```
    @TODO ADD CODE SNIPPET, TABBED
    ```

    * üîë @TODO DON'T FORGET TO USE THE KEY EMOJI ON KEY POINTS, BUT ONLY KEY POINTS, NOT _EVERY_ POINT

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è @TODO { DO WE END OUR REVIEWS WITH A QUESTION? }

    * üôã @TODO { YES, WE DO! }

    * ‚òùÔ∏è What can you do if you don't completely understand this?

    * üôã @TODO We can refer to the lesson plan, read the [{ DOCS }]({ URL }), and stick around for office hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 12. Recap & Promote Additional Resources (5 min)

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è What do you think you absolutely need to know to succeed at the challenge?

    * üôã @TODO { YES, WHAT? }

    * ‚òùÔ∏è What do you think is okay to not completely understand?

    * üôã All of it! The field of web development is very wide and rapidly evolving. Unless you choose to specialize, it is not necessary to know any one area completely to be successful. 

    * ‚òùÔ∏è Why is it important to do as much of the lesson material prior to class as possible?

    * üôã It's important both to be fully prepared to start the challenge and because it will prepare you for your future career as a web developer. We cover a lot of material in the boot camp. Lessons are intentionally designed to give each topic an optimal amount of depth and scope so that you have a solid foundation to build upon in future lessons. The skills you learn in the lessons are cutting-edge, real-world skills that you will use in your career as a full-stack web developer.

* Direct students to the additional resources available to them:

    * Reflection and Retrieval

    * Career Connection

    * Dessert Menu

### 13. Introduce Upcoming Challenge (5 min)

@TODO USE THE FOLLOWING FOR BROWSER AND/OR COMMAND LINE DEMOS, RESPECTIVELY. REMOVE IF UNUSED
* Open `@TODO/folder/file` in your browser and demonstrate the following:
* Run `@TODO/folder/file { AND ARGS, IF ANY }` from the command line and demonstrate the following: 

    * @TODO { WHAT ARE WE GOING TO BE BUILD? }

    * @TODO { ISN'T THIS NEAT! A SOPHISTICATED OR MODERN APPLICATION OF A KEY TOPIC. }

* Ask the class the following questions (‚òùÔ∏è) and call on students for the answers (üôã):

    * ‚òùÔ∏è What are we learning?

    * üôã @TODO { YES, WHAT? }.

    * ‚òùÔ∏è How does this project build off or extend previously learned material?

    * üôã @TODO {YES, WHAT? }.

    * ‚òùÔ∏è How does this project relate to your career goals?

    * üôã @TODO { HOW DO COMPANIES USE IT IN INTERESTING WAYS? HOW POPULAR OR IN-DEMAND IS IT? WHY IS THE PROJECT ENTICING TO EMPLOYERS? }

* Answer any questions before proceeding to the next activity.

### 14. Office Hours (30 min)

* Announce Office Hours and encourage students to stay on the Zoom and start the challenge while they have live support from instructional staff. 


### 15. End 

How did today‚Äôs lesson go? Your feedback is important. Please take 5 minutes to complete [this anonymous survey](https://forms.gle/3LozVjherGH83aG17).

---
¬© 2020 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.

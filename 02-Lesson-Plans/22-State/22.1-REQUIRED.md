# Module 22 Virtual Class: State

## Overview

In today's virtual class, students will be introduced to complex state management within their apps. They will learn about key state management concepts like providers and consumers.

## Learning Objectives

By the end of class, students will be able to:

* Explain and use providers inside a React component.

* Explain the concept of `Consumer` and accessing React `Context`.

## Instructor Notes

* Be sure to prepare and read over the activities before your class begins. Try to anticipate any questions students may have.

* **Important**: React Router recently [upgraded to version 6](https://reactrouter.com/docs/en/v6/upgrading/v5#upgrade-to-react-router-v6) which includes breaking changes with `<Switch>`, `<Redirect> ` and other elements. The content of this week's in-class and module activities uses React Router version 5. To make sure that students can follow along with activities -- as currently written -- please instruct students to use this npm command to install React Router version 5: `npm install react-router-dom@5`.

* **Important**: Be sure to create a practice React app before class, by navigating to `01-Class-Content/22-State/01-Activities` and running the following command:

  ```sh
  npx create-react-app 00-practice-app
  ```

* In order to avoid continuous NPM installs, all of this week's activities' Solved and Unsolved folders include only a `src` folder. Swap out the `src` folder for each activity in `00-practice-app`. It's recommended that you completely restart the dev server between activities.

* To avoid errors due to conflicting versions of ESLint in the repo, navigate to `00-practice-app` in the command line and run the following command:

  ```sh
  echo "SKIP_PREFLIGHT_CHECK=true" > .env
  ```

* Inform students that not every React application calls for the use of complex state management. Explain that it might be beneficial only when data needs to be accessible by many components at different nesting levels.

* During activities, visit a few breakout rooms and check if the group is having any problems using `00-practice-app` for their activities.

* Both providers and consumers were covered in Lesson 1.

## Time Tracker

| Start  | #  | Activity Name                       | Duration |
|---     |--- |---                                  |---       |
| 6:30PM | 0  | Office Hours                        | 0:30     |
| 7:00PM | 1  | Everyone Do: Career Connection      | 0:20     |
| 7:20PM | 2  | Instructor Do: Student Check-In     | 0:05     |
| 7:25PM | 3  | Instructor Demo: Providers          | 0:05     |
| 7:30PM | 4  | Student Do: Providers               | 0:15     |
| 7:45PM | 5  | Instructor Review: Providers        | 0:10     |
| 7:55PM | 6  | Instructor Demo: Consumers          | 0:05     |
| 8:00PM | 7  | Student Do: Consumers               | 0:15     |
| 8:15PM | 8  | Instructor Review: Consumers        | 0:10     |
| 8:25PM | 9  | Recap                               | 0:05     |
| 8:30PM | 10 | Challenge Review                    | 0:30     |
| 9:00PM | 11 | End                                 | N/A      |

---

## Class Instructions

### 1. Everyone Do: Career Connection (20 min)

* Welcome students to class.

* Invite students to post questions in the Zoom chat so TAs and/or the instructor can address them at the end of class.

* Open the lesson's [slide deck](https://docs.google.com/presentation/d/1BmyoxhAugArTWcg5NVtZOaDJ3YJX4g12vi_k0B9lZRY/edit?usp=sharing) and walk through the following slides on foundation setting:

  **Big Picture**: This is an opportunity to look at the big picture of where students are in the course. Take a moment to discuss a few real-world examples of why this week's topics are valuable.

  **Boot Camp Pointers**: Review some logistics that will help students stay on track. This is an opportunity to speak to what students might need at this particular point in the course.

  **This Week**: Review the key skills students will be learning this week.

  **This Week's Assignment**: Give a quick summary of this week's Challenge assignment and describe how the skills they learn throughout the week will be applied to it.

  **Career Connection**: Reinforce that students will use the skills they learn this week throughout their careers. It's important for them to know the "why" and "how" behind the "what." Give examples of how these skills are used on the job. If you feel comfortable, share examples of how you have used them in your professional career.

    * This week, students will learn about global state management using the React Context API and Redux. Let them know that global state isn't always necessary for smaller applications, but knowing how to work with it will give them a competitive advantage when applying for jobs because it is very common at many companies.

    * This is the last week that students will see async content from career services. Remind them that by now they should have completed the following materials:

      * Resume

      * Portfolio

      * GitHub profile with 5&ndash;6 pinned repositories

      * LinkedIn profile

    * Each of these pieces should have been checked off by a Career Materials Advisor (CMA) so that the student can be determined as employer-ready. Only then will they gain access to resources such as our employer referral program. Encourage students to complete and submit these tasks ASAP if they have not already done so!

    * Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

      * â˜ Who here is employer-ready? What does it mean to be employer-ready?

        **Note**: You will likely get a mix of answers from students who a) are employer-ready, b) are not employer-ready, or perhaps even c) don't know what employer-ready is.

      * ğŸ™‹ **Employer-ready** means that you have completed the required professional materials as laid out by career services. For web developers, this means having the following:

        * Resume

        * GitHub profile

        * Portfolio

    * Remind students that they need to submit all of these materials to a Career Material Advisor (CMA) via Canvas or BootcampSpot (depending on your class) in order to have them approved. Once they are all approved, students should check about employer-ready status with their Career Coach.

    * We know from our data that students who put in the work to become employer-ready and open up referrals and other career services resources are among the most successful in job placement rates!

    * Encourage students to become employer-ready by submitting their materials this week! For all those who have not done so, extend the challenge to complete these by end of the week and submit to a Career Material Advisor.

    **How to Succeed This Week**: Remind students that they might experience moments of frustration as they learn complex concepts and tools, and that these times are actually proven opportunities to deepen knowledge. Consider sharing something about your personal learning journey. This helps students recognize that everyone starts somewhere and that they are not alone.

    **Today's Objectives:** Outline the concepts that will be covered in today's lesson. Remind students that they can find the relevant activity files in the "Getting Ready for Class" page in their course content.

### 2. Instructor Do: Student Check-In (5 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How are you feeling about your progress so far?

  * ğŸ™‹ We are adding another layer to our full-stack skill set. It's important to look back at what we accomplished and acknowledge that it is a lot! Itâ€™s also okay to feel overwhelmed&mdash;as long as you donâ€™t give up.

  * â˜ï¸ How comfortable do you feel with this topic?

  * ğŸ™‹ Let's do Fist to Five together. If you are not feeling confident, hold up a fist (0). If you feel very confident, hold up an open hand (5).

### 3. Instructor Demo: Providers (5 min)

* Open `01-Providers/Solved` in your IDE and demonstrate the following:

  * ğŸ”‘ Today we will be using the [00-practice-app](../../01-Class-Content/22-State/01-Activities/00-practice-app) application for all of our activities.

  * ğŸ”‘ First, we copy the [src](../../01-Class-Content/22-State/01-Activities/01-Providers/Solved/src) folder and paste it into the `00-practice-app` app directory.

  * ğŸ”‘ Then we navigate to `00-practice-app` in our command line and run `npm install` and `npm start` to set up the app.

  * ğŸ”‘ Start the app in dev mode by running `npm start`. The app will open automatically in the browser at <http://localhost:3000>

  * ğŸ”‘ The React Context hook returns a value called `Provider` and a `Consumer` which are both React components. For now, let's focus on the `Provider` component and work with the `Consumer` component later.

  * ğŸ”‘ The `Provider` component is a React Context API component that provides a value to all of its children. In our case, the value we are providing is an initial state object that contains an array of `students`.

  * ğŸ”‘ Each student is an object with a `name`, `major`, and `id` property which are used to render each student in the `StudentList` component.

  * In the upcoming activity you will use some pre-written tests to ensure that your implementation is correct. Remember, to run the tests use `npm run test` followed by pressing the `a` key to run all tests.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How does this activity equip us for the Challenge?

  * ğŸ™‹ This activity will help us understand how to use the React Context API provides us with two components: `Provider` and `Consumer`. The `Provider` component is a React Context API component that provides a value to all of its children.

* Answer any questions before proceeding to the next activity.

### 4. Student Do: Providers (15 min)

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `01-Providers/README.md`, which are also shown here:

  ````md
  # ğŸ—ï¸ Implement Global State with React Context API

  Initializing a React application by using the `create-react-app` command-line utility can take some time. To save time throughout this unit, we will create one React application and only replace the `/src` files for each subsequent activity as we work on them. Before you add comments to the code, you will practice the workflow for creating a React app and updating your practice app for subsequent activities.

  To do this, follow these steps:

    1. In the command line, navigate to `22-State/01-Activities`.

    2. Run the command `npx create-react-app 00-practice-app`.

    3. After `create-react-app` has completed (which can take a few minutes), copy the `/src` folder from each activity and paste it into [00-practice-app](../00-practice-app/).

  ## Activity

  Work with a partner to implement the following user story:

  * As a developer, I want to consume data/values from a single, global source across my entire React application.

  ## Acceptance Criteria

  * It's done when a global state object has been defined with the following properties: an array of students with `name` and `major` properties.

  * It's done when the provider is made available to child components.

  * It's done when the associated test suite passes with zero failures when `npm run test` is run.

  ---

  ## ğŸ’¡ Hints

  When defining global state, which properties should be present? Should we care what type they are initialized with?

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * Can an app have multiple providers? If so, are they allowed to be nested?

  Use [Google](https://google.com) or another search engine to research this.
  ````

### 5. Instructor Review: Providers (10 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with providers as a concept? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ `React.CreateContext()`

  * âœ”ï¸ Providers

  * âœ”ï¸ `npm run test`

* Open `01-Providers/Solved/src/utils/StudentContext.js` in your IDE and explain the following:

  * To create a global state object for this application, we have to first import `createContext` along with `useContext`:

    ```js
    import React, { createContext, useContext } from 'react';
    ```

  * ğŸ”‘ We begin by creating a context for students called `StudentContext`:

    ```js
    const StudentContext = createContext();
    ```

  * ğŸ”‘ `useContext` is a Hook that allows us to create custom methods that will make the context available inside other components. It accepts an argument of a context object. Here we pass in `StudentContext`:

    ```js
    export const useStudentContext = () => useContext(StudentContext);
    ```

  * We can see that `StudentProvider` is a function that accepts props and will return the `Provider` component. It also contains the initial state object.

  * It is important to note that we receive `children` as a property inside the `props` object. We are using destructuring assignment to assign it to the variable `children`:

    ```js
    export const StudentProvider = ({ children }) => { };
    ```

  * The provider accepts an initial state object that we will pass to it. Here we add the two students to the array:

    ```js
    const initialState = {
    students: [
      {
        id: 1,
        name: 'Sayid',
        major: 'Computer Science',
      },
      {
        id: 2,
        name: 'Sun-Hwa',
        major: 'Data Science',
      },
    ],
    ```

  * As mentioned previously, we want to return the provider from the `StudentContext()` function. To do that, we pass it a value attribute of the `initialState`.

  * We also render the children by placing `children` in curly braces inside the `Provider` component:

    ```jsx
    return (
      <StudentContext.Provider value={initialState}>
        {children}
      </StudentContext.Provider>
    );
    ```

* Navigate to the `App` component and note the following:

  * Inside the `App` component, we can see that `StudentList` is wrapped inside `StudentProvider`. Thus, we should be able to use the initial state object that was passed as a value:

    ```js
    return (
      <div>
        <StudentProvider>
          <StudentList />
        </StudentProvider>
      </div>
    );
    ```

* Navigate to the `/components/StudentList` component and explain the following:

  * First, inside the `StudentList` component, we import the custom `useStudentContext` Hook. This will give us access to the `students` array:

    ```js
    import { useStudentContext } from '../utils/StudentContext';

    export default function StudentList() {
      const { students } = useStudentContext();
    }
    ```

  * Now that we have imported the custom Hook and have access to the `students` array, we can finally use `students` in the component. Here we are mapping over each student and returning a new array that contains a `li` element for each one:

    ```js
    return (
      <>
        <span>Looks good here, make sure to run the tests!</span>
        <ul>
          {students.map((student) => (
            <li key={student.name}>
              {student.name} : {student.major}
            </li>
          ))}
        </ul>
      </>
    );
    ```

* Make sure you have copied the `src` directory from `01-Providers` and pasted it into `00-practice-app`.

* Navigate to `00-practice-app` in your command line and run `npm install` and `npm run test`.

  * We run `npm run test` from the command line to check that we wrote everything correctly and the unit tests are passing:

    ```bash
    PASS  src/__tests__/app.test.js
      âœ“ StudentList shows value from provider (28 ms)

    Test Suites: 1 passed, 1 total
    Tests:       1 passed, 1 total
    Snapshots:   0 total
    Time:        2.303 s
    Ran all test suites.
    ```

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What is the purpose of the `Provider` component?

  * ğŸ™‹ The `Provider` component allows child components to subscribe to changes in the given context.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [React documentation on Context.Provider](https://reactjs.org/docs/context.html#contextprovider), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 6. Instructor Demo: Consumers (5 min)

* Open `02-Consumers/Solved` in your IDE and demonstrate the following:

  * ğŸ”‘ Again, we will need to copy the `src` folder and replace the `src` folder from the last activity in the `00-practice-app` app with this one.

  * ğŸ”‘ Navigate to the [00-practice-app/client](../../01-Class-Content/22-State/01-Activities/00-practice-app/client) directory in your command line and run `npm run test`.

  * ğŸ”‘ In this example, we can see that all our tests are passing for the `Consumer` component.

  * ğŸ”‘ The consumer component is a React component that subscribes to context changes. This component requires that you pass it a function as a child.

  * ğŸ”‘ The function will receive the current context value and return a React node. We can look at the example found in the [React Docs on Context.Consumer](https://reactjs.org/docs/context.html#contextconsumer).

  * ğŸ”‘ You can only subscribe to one context at a time using the consumer component. If you want to subscribe to multiple contexts, you can use the `useContext` Hook.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ Where have we used this before?

  * ğŸ™‹ We used consumers in Lesson 1.

  * â˜ï¸ How does this activity equip us for the Challenge?

  * ğŸ™‹ Writing tests will help us to test the functionality of our Consumers and make sure that we are getting context values that we expect.

* Answer any questions before proceeding to the next activity.

### 7. Student Do: Consumers (15 min)

* Direct students to the activity instructions found in `02-Consumers/README.md`.

* Break your students into pairs that will work together on this activity.

  ```md
  # ğŸ—ï¸ Access and Update Global State Using React Context Hooks

  Work with a partner to implement the following user story:

  * As a developer, I want to have access to a global state object to avoid passing props down through multiple child components.

  ## Setup

  Copy the `src` directory from the activity folder into `00-practice-app` before you begin.

  ## Acceptance Criteria

  * It's done when the `studentList` component pulls the global state variables `students` and `majors`.

  * It's done when the `studentList` components add and remove buttons to update the global state object.

  * It's done when changes in global state are reflected in necessary components.

  * It's done when the components render properly in the browser.

  ---

  ## ğŸ’¡ Hints

  What argument does `useContext()` accept?

  ## ğŸ† Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * When might you prefer to use the Context API as opposed to prop drilling?

  Use [Google](https://google.com) or another search engine to research this.
  ```

* While breaking everyone into groups, be sure to remind students and the rest of the instructional staff that questions on Slack or otherwise are welcome and will be handled. It's a good way for your team to prioritize students who need extra help.

### 8. Instructor Review: Consumers (10 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ How comfortable do you feel with consumers? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (ğŸ”‘) below to review the following key points:

  * âœ”ï¸ `useContext` Hook

  * âœ”ï¸ Global state

  * âœ”ï¸ Prop drilling

* Open `02-Consumers/Unsolved/src/utils/StudentContext.js` in your IDE and explain the following:

  * In this activity we accessed global state variables `student` and `majors` inside the `StudentList` component. To do that, we needed a custom Hook that would grant us access to those values.

  * The `StudentContext.js` file contains the custom Hook that gets exported:

    ```js
    export const useStudentContext = () => useContext(StudentContext);
    ```

  * `StudentContext` gets passed a value of an object that contains not only the `students` array, but also the various methods to update students:

    ```js
    return (
      <StudentContext.Provider
        value={{ students, addStudent, removeStudent, majors }}
      >
        {children}
      </StudentContext.Provider>
    ```

* Open `/src/components/StudentList` and note the following:

  * At the top of the `StudentList` component, we import the custom `useStudentContext` to get the consume values from the context.

  * We use destructuring assignment to give the `students` array and methods to their own variable names that can be used inside the `StudentList` component:

    ```js
    import React, { useState } from 'react';
    import { useStudentContext } from '../utils/StudentContext';

    export default function StudentList() {
      const { students, addStudent, removeStudent, majors } = useStudentContext();
      ...
    }
    ```

  * Using the methods that we can now access, the next step is to add the `onClick` event to the button for removing a student:

    ```jsx
    {students.map((student) => (
      <tr key={student.id}>
        <td>{student.id}</td>
        <td>{student.name}</td>
        <td>{student.major}</td>
        <td>
          <button
            type="button"
            onClick={() => removeStudent(student.id)}
          >
            <span role="img" aria-label="close">
              âœ–ï¸
            </span>
          </button>
        </td>
      </tr>
    ))}
    ```

  * To properly display a list of available majors on the page, we map over each major and return an `option` element for each one.

  * As with all JavaScript code inside JSX, we wrap all of it inside curly braces:

    ```js
    {majors.map((major) => (
      <option key={major} value={major}>
        {major}
      </option>
    ))}
    ```

  * Next, we make the Add Student button work by adding an `onClick` that would invoke the `addStudent()` method:

    ```js
    <button
      type="button"
      onClick={() => {
        addStudent({ name: newStudentName, major: newStudentMajor });
        setNewStudentName('');
        setNewStudentMajor('');
      }}
    >
      Add Student
    </button>
    ```

  * In the return method for `StudentList`, we use the `students` array itself to conditionally render either a student list or a message that no students were found.

  * Because we are using the `students` array provided to us by the `useContext` Hook, we can reference it in the component:

    ```js
    return (
      <div>
        {students ? (
          <>
            <section className="student-list">
            ...
            </section>
          </>
        ) : (
          <span>Hmm... seems that there are no students here!</span>
        )}
      </div>
    );
    ```

* Run `npm start` in your command-line window to demonstrate the finished application's functionality in the browser.

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What are the two different ways that we can consume context?

  * ğŸ™‹ We can use the `useContext` Hook inside a custom Hook and make that available to other components, or we can use the `<MyContext.Consumer>` component to reference variables directly.

  * â˜ï¸ What can we do if we don't completely understand this?

  * ğŸ™‹ We can refer to supplemental material, read the [React documentation on useContext](https://reactjs.org/docs/hooks-reference.html#usecontext), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 9. Recap (5 min)

* Ask the class the following questions (â˜ï¸) and call on students for the answers (ğŸ™‹):

  * â˜ï¸ What topics did we cover today? What are the main takeaways?

  * ğŸ™‹ We covered providers and consumers.

  * â˜ï¸ What do you think is okay to not completely understand?

  * ğŸ™‹ All of it! The field of web development is very wide and rapidly evolving. Unless you choose to specialize, it's not necessary to know any one area completely to be successful.

  * â˜ï¸ Why is it important to do as much of the lesson material before class as possible?

  * ğŸ™‹ It's important both to be fully prepared to start the Challenge and because it will prepare you for your future career as a web developer. We cover a lot of material in the boot camp. Lessons are intentionally designed to give each topic an optimal amount of depth and scope so that you have a solid foundation to build upon in future lessons. The skills you learn in the lessons are cutting-edge, real-world skills that you will use in your career as a full-stack web developer.

  * â˜ï¸ Where in the asynchronous lessons can you learn more?

  * ğŸ™‹ All of this was covered in Lesson 1.

  * â˜ï¸ What excites you about the remaining lessons for this week?

* Use student answers to transition to Office Hours.

### 10. Challenge Review (30 min)

* Take this time to help get students unblocked on the current Challenge that they are working through.

* Expect that students may ask for the following:

  * Further review on a particular subject

  * Debugging assistance

  * Help with computer issues

  * Guidance with a particular tool

### 11. End

How did todayâ€™s lesson go? Your feedback is important. Please take 5 minutes to complete [this anonymous survey](https://forms.gle/3LozVjherGH83aG17).

---
Â© 2022 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.

# Module 22 Virtual Class: State

## Overview 

In today's virtual class, students will create actions and reducers to start implementing global state.

## Learning Objectives

By the end of class, students will be able to:

* Explain and use providers inside a React component.

* Explain the concept of Consumer and accessing React Context.

## Instructor Notes

* Be sure to prepare and read over the activities before your class begins. Try to anticipate any questions students may have. 

* **Important**: Be sure to create a practice React app before class, by navigating to `01-Class-Content/22-State/01-Activities` and running the following command:

  ```sh
  npx create-react-app 00-practice-app
  ```

* After each activity, be sure to remove the `src` directory from the practice app and copy the `src` directory from the activity into the practice app.

* Once your practice React app has been created, you might encounter some issues regarding conflicting versions of `eslint`. If this is the case, also run the following:

  ```sh
  echo "SKIP_PREFLIGHT_CHECK=true" > .env
  ```

<!-- TODO: IF YOU GET SCRIPT WORKING REVISE THIS ^ -->

* During activities, visit a few breakout rooms and check if the group is having any problems using `00-practice-app` for their activities.

* Creating actions, reducers, and tests for reducers was covered in Lesson 1.

## Time Tracker 

| Start  | #  | Activity Name                       | Duration |
|---     |--- |---                                  |---       |
| 6:30PM | 0  | Office Hours                        | 0:30     |
| 7:00PM | 1  | Everyone Do: Career Connection      | 0:20     |
| 7:20PM | 2  | Instructor Do: Student Check-In     | 0:05     |
| 7:25PM | 3  | Instructor Demo: Providers          | 0:05     |
| 7:30PM | 4  | Student Do: Providers               | 0:15     |
| 7:45PM | 5  | Instructor Review: Providers        | 0:10     |
| 7:55PM | 6  | Instructor Demo: Consumers          | 0:05     |
| 8:00PM | 7  | Student Do: Consumers               | 0:15     |
| 8:15PM | 8  | Instructor Review: Consumers        | 0:10     |
| 8:25PM | 9  | Recap                               | 0:05     |
| 8:30PM | 10 | Challenge Review                    | 0:30     |
| 9:00PM | 11 | End                                 | N/A      |

---

## Class Instructions 

### 1. Everyone Do: Career Connection (20 min)

* Welcome students to class.

* Invite students to post questions in the Zoom chat so TAs and/or the instructor can address them at the end of class.

* Open the lesson's [slide deck](https://docs.google.com/presentation/d/1BmyoxhAugArTWcg5NVtZOaDJ3YJX4g12vi_k0B9lZRY/edit?usp=sharing) and walk through the following slides on foundation setting: 

    **Big Picture**: This is an opportunity to look at the big picture of where students are in the course. Take a moment to discuss a few real-world examples of why this week's topics are valuable.

    **Boot Camp Pointers**: Review some logistics that will help students stay on track. This is an opportunity to speak to what students might need at this particular point in the course. 

    **This Week**: Review the key skills students will be learning this week. 

    **This Week's Assignment**: Give a quick summary of this week's Challenge assignment and describe how the skills they learn throughout the week will be applied to it.

    **Career Connection**: Reinforce that students will use the skills they learn this week throughout their careers. It's important for them to know the "why" and "how" behind the "what." Give examples of how these skills are used on the job. If you feel comfortable, share examples of how you have used them in your professional career.

    * This week, students will learn about global state management using the React Context API and Redux. Let them know that global state isn't always necessary for smaller applications, but knowing how to work with it will give them a competitive advantage when applying for jobs because it is very common at many companies.

    * This is the last week that students will see async content from career services. Remind them that by now they should have completed the following materials:

        * Resume
        * Portfolio
        * GitHub profile with 5&ndash;6 pinned repositories
        * LinkedIn profile

    * Each of these pieces should have been checked off by a Career Materials Advisor (CMA) so that the student can be determined as employer-ready. Only then will they gain access to resources such as our employer referral program. Encourage students to complete and submit these tasks ASAP if they have not already done so! 

    * Ask the class the following questions (☝️) and call on students for the answers (🙋):

        * ☝ Who here is employer-ready? What does it mean to be employer-ready?

          **Note**: You will likely get a mix of answers from students who a) are employer-ready, b) are not employer-ready, or perhaps even c) don't know what employer-ready is.

        * 🙋 **Employer-ready** means that you have completed the required professional materials as laid out by career services. For web developers, this means having the following:

            * Resume
            * GitHub profile
            * Portfolio

    * Remind students that they need to submit all of these materials to a Career Material Advisor (CMA) via Canvas or BootcampSpot (depending on your class) in order to have them approved. Once they are all approved, students should check about employer-ready status with their Career Coach.

    * We know from our data that students who put in the work to become employer-ready and open up referrals and other career services resources are among the most successful in job placement rates! 

    * Encourage students to become employer-ready by submitting their materials this week! For all those who have not done so, extend the challenge to complete these by end of the week and submit to a Career Material Advisor.

    **How to Succeed This Week**: Remind students that they might experience moments of frustration as they learn complex concepts and tools, and that these times are actually proven opportunities to deepen knowledge. Consider sharing something about your personal learning journey. This helps students recognize that everyone starts somewhere and that they are not alone.

    **Today's Objectives:** Outline the concepts that will be covered in today's lesson. Remind students that they can find the relevant activity files in the "Getting Ready for Class" page in their course content.

### 2. Instructor Do: Student Check-In (5 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How are you feeling about your progress so far?

  * 🙋 We are adding another layer to our full-stack skill set. It's important to look back at what we accomplished and acknowledge that it is a lot! It’s also okay to feel overwhelmed&mdash;as long as you don’t give up.

  * ☝️ How comfortable do you feel with this topic?

  * 🙋 Let's do Fist to Five together. If you are not feeling confident, hold up a fist (0). If you feel very confident, hold up an open hand (5).

### 3. Instructor Demo: Providers (5 min) 

* Open `01-Providers/Solved` in your IDE and demonstrate the following:

  * 🔑 Today we will be using the [00-practice-app](../../01-Class-Content/22-State/01-Activities/00-practice-app) folder for all of our activities. 

  * 🔑 First, we copy the [src](../../01-Class-Content/22-State/01-Activities/01-Providers/Solved/src) folder and paste it into the `00-practice-app` app directory. 

  * 🔑 Then we navigate to `00-practice-app` in our command line and run `npm install` and `npm start` to set up the app.

  * 🔑 Start the app in dev mode by running `npm start`. The app will open automatically in the browser at <http://localhost:3000>

  * 🔑 The React Context hook returns a value called `Provider` and a `Consumer` which are both React components. For now, let's focus on the `Provider` component and catch with the `Consumer` component later.

  * 🔑 The `Provider` component is a React Context API component that provides a value to all of its children. In our case, the value we are providing is an initial state object that contains an array of `students`.

  * 🔑 Each student is an object with a `name`, `major`, and `id` property which are used to render each student in the `StudentList` component.

  * In the upcoming activity you will use some pre-written tests to ensure that your implementation is correct. Remember, to run the tests use `npm run test`.
    
* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How does this activity equip us for the Challenge?

  * 🙋 This activity will help us understand how to use the React Context API provides us with two components: `Provider` and `Consumer`. The `Provider` component is a React Context API component that provides a value to all of its children.

* Answer any questions before proceeding to the next activity.

### 4. Student Do: Providers (15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `01-Providers/README.md`, which are also shown here:

  ```md
  # 🏗️ Implement Global State with React Context API

  Work with a partner to implement the following user story:

  * As a developer, I want to consume data/values from a single, global source across my entire React application.

  ## Setup

  Create a new React app called `00-practice-app` by running the following command:

  ```bash
  npx create-react-app 00-practice-app
  ```

  Copy the `src` directory from the `Unsolved` folder into `00-practice-app` before you begin.

  ## Acceptance Criteria

  * It's done when a global state object has been defined with the following properties: an array of students with `name` and `major` properties.

  * It's done when the provider is made available to child components.

  * It's done when the associated test suite passes with zero failures when `npm run test` is run.

  ---

  ## 💡 Hints

  When defining global state, which properties should be present? Should we care what type they are initialized with?

  ## 🏆 Bonus

  If you have completed this activity, work through the following challenge with your partner to further your knowledge:

  * Can an app have multiple providers? If so, are they allowed to be nested?

  Use [Google](https://google.com) or another search engine to research this.
  ```

### 5. Instructor Review: Providers (10 min) 

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ How comfortable do you feel with providers as a concept? (Poll via Fist to Five, Slack, or Zoom)

* Assure students that we will cover the solution to help solidify their understanding. If questions remain, remind them to use office hours to get extra help!

* Use the prompts and talking points (🔑) below to review the following key points:

  * ✔️ `React.CreateContext()`

  * ✔️ Providers

  * ✔️ `npm run test`

* Open `01-Providers/Solved/src/utils/StudentContext.js` in your IDE and explain the following:

  * To create a global state object for this application, we have to first import `createContext` along with `useContext`:

    ```js
    import React, { createContext, useContext } from 'react';
    ```
  
  * 🔑 We begin by creating a context for students called `StudentContext`:

    ```js
    const StudentContext = createContext();
    ```

  * 🔑 `useContext` is a Hook that allows us to create custom methods that will make the context available inside other components. It accepts an argument of a context object. Here we pass in `StudentContext`:
  
    ```js
    export const useStudentContext = () => useContext(StudentContext);
    ```

  * We can see that `StudentProvider` is a function that accepts props and will return the `Provider` component. It also contains the initial state object.
  
  * It is important to note that we receive `children` as a property inside the `props` object. We are using destructuring assignment to assign it to the variable `children`:

    ```js
    export const StudentProvider = ({ children }) => { };
    ```

  * The provider accepts an initial state object that we will pass to it. Here we add the two students to the array:

    ```js
    const initialState = {
    students: [
      {
        id: 1,
        name: 'Sayid',
        major: 'Computer Science',
      },
      {
        id: 2,
        name: 'Sun-Hwa',
        major: 'Data Science',
      },
    ],
    ```

  * As mentioned previously, we want to return the provider from the `StudentContext()` function. To do that, we pass it a value attribute of the `initialState`.

  * We also render the children by placing `children` in curly braces inside the `Provider` component:

    ```jsx
    return (
      <StudentContext.Provider value={initialState}>
        {children}
      </StudentContext.Provider>
    );
    ```

* Navigate to the `App` component and note the following:

  * Inside the `App` component, we can see that `StudentList` is wrapped inside `StudentProvider`. Thus, we should be able to use the initial state object that was passed as a value:

    ```js
    return (
      <div>
        <StudentProvider>
          <StudentList />
        </StudentProvider>
      </div>
    );
    ```

* Navigate to the `/components/StudentList` component and explain the following:

  * First, inside the `StudentList` component, we import the custom `useStudentContext` Hook. This will give us access to the `students` array:

    ```js
    import { useStudentContext } from '../utils/StudentContext';

    export default function StudentList() {
      const { students } = useStudentContext();
    }
    ```

  * Now that we have imported the custom Hook and have access to the `students` array, we can finally use `students` in the component. Here we are mapping over each student and returning a new array that contains a `li` element for each one:

    ```js
    return (
      <>
        <span>Looks good here, make sure to run the tests!</span>
        <ul>
          {students.map((student) => (
            <li key={student.name}>
              {student.name} : {student.major}
            </li>
          ))}
        </ul>
      </>
    );
    ```

* Make sure you have copied the `src` directory from `01-Providers` and pasted it into `00-practice-app`.

* Navigate to `00-practice-app` in your command line and run `npm install` and `npm run test`.

  * We run `npm run test` from the command line to check that we wrote everything correctly and the unit tests are passing: 

    ```bash
    PASS  src/__tests__/app.test.js
      ✓ StudentList shows value from provider (28 ms)

    Test Suites: 1 passed, 1 total
    Tests:       1 passed, 1 total
    Snapshots:   0 total
    Time:        2.303 s
    Ran all test suites.
    ```

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

  * ☝️ What is the purpose of the `Provider` component?

  * 🙋 The `Provider` component allows child components to subscribe to changes in the given context.

  * ☝️ What can we do if we don't completely understand this?

  * 🙋 We can refer to supplemental material, read the [React documentation on Context.Provider](https://reactjs.org/docs/context.html#contextprovider), and stay for office hours to ask for help.

* Answer any questions before proceeding to the next activity.


### 6. Instructor Demo: Test Reducers (5 min) 

* Open `02-Test-Reducers/Solved` in your IDE and demonstrate the following:

    * 🔑 Again, we will need to copy the `src` folder and replace the `src` folder from the last activity in the `00-practice-app` app with this one.

    * 🔑 Navigate to the [00-practice-app/client](../../01-Class-Content/22-State/01-Activities/00-practice-app/client) directory in your command line and run `npm run test`.

    * 🔑 You should see that both tests for the reducers passed.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

    * ☝️ Where have we used this before?

    * 🙋 We created tests for reducers in Lesson 1.

    * ☝️ How does this activity equip us for the Challenge?

    * 🙋 Writing tests will help us to test the functionality of our reducers to see if we get the intended output. This will also help us understand the purpose of reducer functions.

    * ☝️ How would we build this?

    * 🙋 We will need to write two tests for each reducer.

* Answer any questions before proceeding to the next activity.

### 7. Student Do: Test Reducers (15 min) 

* Divide students into breakout rooms.

* Direct students to the activity instructions found in `02-Test-Reducers/README.md`, which are also shown here:

   ```md
   # Test Reducers

   In this activity, you will create tests to check if the reducers we created in the previous activity will work properly in production.

   ## Instructions

   * **Note** You will be using one web application, [00-practice-app](../00-practice-app), for all of our activities today.

   * Copy the [src](Unsolved/src) folder and paste it into the `00-practice-app` app inside the [client](../00-practice-app/client) folder. 

   * In the [src](../00-practice-app/client/src/) folder, create a new folder for tests, and inside it, create a file called `reducers.test.js`.

     * Import the reducer and the two actions at the top of the page.

     * Create the `initialState` to use for the tests. Include a `books` array and `currentBook` object in this sample of global state.

     * Write a test for `UPDATE_BOOKS`. Check the `BookList` and `Detail` pages to see when we would need to use this action. Think carefully about how we would use this action and what we want to test. 

     * Write a test for `UPDATE_CURRENT_BOOK`. You don't have to change all of the fields of the `currentBook` for our testing purposes. You can change just one field, like the `title`, and test that.

   * Navigate to the [client](../00-practice-app/client) directory and run `npm run test`. Check if all of the tests passed.

   ## Hint(s)

   * You can refer to the [Create React App Docs on Running Tests](https://create-react-app.dev/docs/running-tests/).
   ```

### 8. Instructor Review: Test Reducers (10 min) 

* Bring students back from breakout rooms. 

* Use the prompts and talking points (:key:) below to review the following key points (✔️):

    * ✔️ `initialState`

    * ✔️ Test for `UPDATE_BOOKS`

    * ✔️ Test for `UPDATE_CURRENT_BOOK`

* Open `02-Test-Reducer/Solved/src/_tests_/reducers.test.js` in your IDE and explain the following: 

    * Be sure to have created a folder called `__tests__`, and inside that folder create a file called `reducers.test.js`. Jest will look for that when running the tests.

    * We import the reducer and our two actions at the top of the page.

       ```js
       import { reducer } from '../utils/reducers';
       import { UPDATE_BOOKS, UPDATE_CURRENT_BOOK } from '../utils/actions';
       ```

    * 🔑 We create the `initialState` for our tests to use. We need to include a `books` array, which we can set to an empty array, and a `currentBook` object.

       ```js
       const initialState = {
         books: [],
         currentBook: {
           _id: '1',
           title: 'Book 1',
           author: 'Author One',
           pages: 123,
           description: 'This is Book 1 for testing purposes'
         }
       };
       ```

    * 🔑 Once we have that set up, we can write our first test for `UPDATE_BOOKS`. Think about what this action is doing. We are storing the list of books in `books` and if we add or take out any books from that list, this action should update the state and return the current `books` array. 
    
    * So let's test that! We can simply add a couple of empty objects to the `books` array.

       ```js
       test('UPDATE_BOOKS', () => {
         let newState = reducer(initialState, {
           type: UPDATE_BOOKS,
           books: [{}, {}]
         });

         expect(newState.books.length).toBe(2);
         expect(initialState.books.length).toBe(0);
       });
       ```

    * 🔑 Then we also need to test the `UPDATE_CURRENT_BOOK` action. Again think about what this action is doing. It is updating the `currentBook` with whatever book the user chooses. For our testing purposes, we don't have to replace the whole `currentBook` object, but maybe just the title.

       ```js
       test('UPDATE_CURRENT_BOOK', () => {
         let newState = reducer(initialState, {
           type: UPDATE_CURRENT_BOOK,
           currentBook: { title: 'Book 2' }
         });

         expect(newState.currentBook.title).toBe('Book 2');
         expect(initialState.currentBook.title).toBe('Book 1');
       });
       ```

    * But ideally, we should've replaced the whole content of `currentBook` and then tested one field to see if the `currentBook` indeed updated. But for the sake of time, we simplified the test.

* Navigate to `00-practice-app/client` and run `npm run test`. Check if all of the tests passed.

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

    * ☝️ Why are we creating a new state object when we are updating the state?

    * 🙋 Remember that state is read-only. We don't alter the state directly. We make a copy of the state, make changes, then use that new state. 

    * ☝️ What can we do if we don't completely understand this?

    * 🙋 We can refer to Lesson 1, read the [Create React App Docs on Running Tests](https://create-react-app.dev/docs/running-tests/), and stay for Office Hours to ask for help.

* Answer any questions before proceeding to the next activity.

### 9. Recap (5 min)

* Ask the class the following questions (☝️) and call on students for the answers (🙋):

    * ☝️ What topics did we cover today? What are the main takeaways?

    * 🙋 We covered actions and reducers in preparation for setting up global state. We also wrote tests to check if the reducers work properly.

    * ☝️ What do you think is okay to not completely understand?

    * 🙋 All of it! The field of web development is very wide and rapidly evolving. Unless you choose to specialize, it's not necessary to know any one area completely to be successful. 

    * ☝️ Why is it important to do as much of the lesson material before class as possible?

    * 🙋 It's important both to be fully prepared to start the Challenge and because it will prepare you for your future career as a web developer. We cover a lot of material in the boot camp. Lessons are intentionally designed to give each topic an optimal amount of depth and scope so that you have a solid foundation to build upon in future lessons. The skills you learn in the lessons are cutting-edge, real-world skills that you will use in your career as a full-stack web developer. 

    * ☝️ Where in the asynchronous lessons can you learn more?

    * 🙋 All of this was covered in Lesson 1.

    * ☝️ What excites you about the remaining lessons for this week?

* Use student answers to transition to Office Hours.

### 10. Challenge Review (30 min)

* Take this time to help get students unblocked on the current Challenge that they are working through.

* Expect that students may ask for the following:

  * Further review on a particular subject

  * Debugging assistance

  * Help with computer issues

  * Guidance with a particular tool

### 11. End

How did today’s lesson go? Your feedback is important. Please take 5 minutes to complete [this anonymous survey](https://forms.gle/3LozVjherGH83aG17).

---
© 2021 Trilogy Education Services, LLC, a 2U, Inc. brand. Confidential and Proprietary. All Rights Reserved.
